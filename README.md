# EvalVoteAI

## 제작 동기

교내 학생들이 자신의 프로젝트를 수행하는 과정에서 설문조사가 필요한 경우가 있다. 하지만 이미 시행되지 않은 설문 조사는 직접 수행해야하는 문제가 있다. 이러한 과정에서 많은 표본을 얻지 못하면 이는 설문조사의 효력을 잃게 된다. 마침 AI 페르소나가 특정 인물에 대한 세세한 정보를 준다면 매우 잘 따라한다는 사실을 알게되었다. 이에 많은 ai페르소나를 제작해서 설문을 할 수 있는 시스템을 제작하고자 함.

---

## 프로젝트 개요

EvalVoteAI는 다양한 AI 페르소나를 자동으로 생성하고, 이들에게 설문을 실시하여 결과를 수집·분석하는 시스템이다. 실제 인간 표본을 대체하거나 보완할 수 있는 대규모 설문 시뮬레이션이 가능하다.

---

## 주요 파일 및 기능 설명

### 1. `EvalVoteAI.py`
- **프로그램의 메인 엔트리포인트**로, 전체 실행 흐름을 담당한다.
- 주요 플로우:
  - **집단 생성**: 여러 소그룹(예: 직업, 연령 등)별로 페르소나를 생성한다.
  - **질문/설문**: 생성된 페르소나 집단에 대해 설문을 실시하고 결과를 저장한다.
  - **집단 수정**: 기존 집단에 소그룹을 추가/삭제할 수 있다.
  - **자동 생성**: 대화형 입력을 통해 소그룹 설계 및 페르소나 생성을 자동화한다.
- **함수별 주요 역할**:
  - `create_group_flow()`: 집단 생성, 질문, 수정, 자동생성 메뉴를 제공한다.
  - `ask_flow()`: 기존 집단에 대해 여러 질문을 입력받아 설문을 반복 수행한다.
  - `modify_group_flow()`: 기존 집단에 소그룹을 추가/삭제한다.
  - `auto_generate_group_flow()`: 대화형으로 소그룹 설계 및 페르소나 생성을 자동화한다.
  - `sys_generate_keywords()`: 소그룹별로 다양한 키워드를 생성한다.
  - `create_personas_for_subgroup()`, `create_one_persona()`: 페르소나를 실제로 생성한다.
  - `ask_many()`, `ask_one_persona()`: 설문 질문을 각 페르소나에 분배하여 응답을 수집한다.
  - `save_vote_outputs()`: 설문 결과를 JSON, 마크다운, 그래프 이미지로 저장한다.

### 2. `config.py`
- **공통 상수, 환경설정, 유틸 함수, 시스템 프롬프트, AI 호출 함수** 등을 관리한다.
- 주요 내용:
  - 환경 변수 로딩, 한글 폰트 설정, JSON 입출력 함수, 폴더명 정제 함수
  - API 키 자동 로딩 함수 (`load_api_keys`)
  - AI 호출 함수 (`call_ai`, `call_ai_with_memory`)
  - 메모리 관리 함수 (`save_memory`, `history_str`, `last_n_history`)
  - 시스템 프롬프트/예시 (`SYS_SYSTEM`, `SUB_SYSTEM`, `SYS1_DIALOG_SYSTEM`, `SYS2_SUMMARIZER_SYSTEM` 등)
  - 설문/페르소나 생성용 프롬프트 빌더 함수 (`build_sub_prompt`, `build_vote_prompt`)
  - 코드 블록/JSON 추출 유틸 (`_strip_code_fence`, `extract_json_array`)

---

## 작동 순서 및 전체 흐름

1. **집단 생성**
   - 사용자 입력을 통해 소그룹(집단 내 하위 그룹) 정보를 입력한다.
   - 각 소그룹별로 AI가 다양한 키워드를 생성한다.
   - 각 소그룹별로 여러 명의 AI 페르소나를 자동 생성한다.
   - 결과는 `PERSONA.json`에 저장된다.

2. **설문/질문**
   - 생성된 페르소나 집단을 불러온다.
   - 사용자가 설문 질문을 입력한다.
   - 각 페르소나가 질문에 대해 답변(이유+1~5점수)을 한다.
   - 결과는 `RESULTS/` 폴더에 JSON, 마크다운, 그래프 이미지로 저장된다.

3. **집단 수정**
   - 기존 집단에 소그룹을 추가하거나 삭제할 수 있다.
   - 삭제 시 해당 소그룹의 페르소나와 메모리 파일도 함께 삭제된다.

4. **자동 생성**
   - 대화형 입력을 통해 소그룹 설계 대화를 진행한다.
   - 대화 로그를 바탕으로 소그룹 설계 JSON을 자동 생성한다.
   - 이후 자동으로 페르소나 생성 및 저장까지 진행된다.

---

## .env 파일 작성법

- AI API 키를 환경변수로 등록해야 한다.
- 예시:
```
SYS_1=your_sys_api_key_1
SYS_2=your_sys_api_key_2
SUB_1=your_sub_api_key_1
SUB_2=your_sub_api_key_2
API_1=your_backup_api_key
```
- SYS/SUB 키는 여러 개 등록 가능하며, SUB 키가 없으면 API 키를 SUB로 사용한다.

---

## 질문(설문) 입력 형식 예시

- **질문 예시**:
  - "이 정책에 대해 어떻게 생각합니까?"
  - "이 제안이 당신의 삶에 긍정적인 영향을 줄 것 같습니까?"
- **출력 형식(페르소나 응답)**:
  - 1) 한 문장 이유
  - 2) 숫자(1~5) 한 글자만 (1=매우 긍정/찬성 ~ 5=매우 부정/반대)

---

## 실행 예시

1. 프로그램 실행:
```
python EvalVoteAI.py
```
2. 집단 생성 메뉴에서 소그룹 정보 입력:
```
소그룹 이름: 대학생
소그룹 정보: 수도권 20대 대학생
공동 요소: 대한민국 거주
페르소나 수: 10
다양성: 전공, 성별, 가치관 등 다양
```
3. 설문 질문 입력:
```
> 이 정책에 대해 어떻게 생각합니까?
```
4. 결과 확인:
- `고등학생/RESULTS/` 등 폴더에 결과가 저장됨
- 마크다운, 그래프, JSON 파일로 확인 가능

---

## 기타 참고사항
- 페르소나별 메모리는 각자 개별 JSON 파일로 관리된다.
- 모든 결과는 UTF-8로 저장된다.
- 한글 폰트는 자동으로 설정된다(윈도우/맥/리눅스 지원).
- API 키가 없으면 동작하지 않는다.
- 질문은 자유롭게 입력 가능하나, 출력 형식은 반드시 2줄(이유+숫자)로 반환된다.
